<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="Cache-Control" content="no-cache,no-store,must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">

    <title>Fè´­å•†åŸ</title>
    <link href="./css/pdd/react_pdd_a097c652b862d01f0d82.css" rel="stylesheet">
    <link href="./css/pdd/react_boot_7bed6699c3a1b0255010.css" rel="stylesheet">
    <link href="./css/pdd/react_common_741fe798d308d87a9aa6.css" rel="stylesheet">
    <link href="./css/pdd/react_goods_b57bbb61f81496814b1f.css" rel="stylesheet">
    <link href="./css/swiper.min.css" rel="stylesheet">
    <style type="text/css">
        .pin-spinner-2 {
            display: none;
            position: fixed;
            width: .66rem;
            height: .66rem;
            top: 35%;
            margin: 0 auto;
            left: 0;
            right: 0;
            z-index: 999999999;
        }

        .ps-inner-box {
            width: 100%;
            height: 100%;
        }

        .ps-rotate-img {
            width: .25rem;
            height: .25rem;
            margin: auto;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            animation: rotateImg 2.5s linear infinite;
            -webkit-animation: rotateImg 2.5s linear infinite;
            z-index: 9999999999;
            position: absolute;
        }

        .ps-rotate-msg {
            width: 100%;
            font-size: .15rem;
            text-align: center;
            color: #fff;
            position: relative;
            bottom: 0px;
            display: none;
        }

        .ps-background {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.7;
            background-color: #000;
            border-radius: .09rem;
        }

        .pin-spinner-2 {
            display: block;
            top: 50%;
            margin-top: -.66rem;
            width: .66rem;
            height: .66rem;
        }

        .pin-spinner-2.hasMessageText {
            margin-top: -.82rem;
            width: 1rem;
            height: 1rem;
        }

        .hasMessageText .ps-rotate-img {
            bottom: .43rem;
            top: .18rem;
            width: .36rem;
            height: .36rem;
        }

        .hasMessageText .ps-rotate-msg {
            display: block;
            bottom: .32rem;
        }


        @keyframes rotateImg {
            0% {
                transform: rotateZ(0deg);
            }
            50% {
                transform: rotateZ(180deg);
            }
            100% {
                transform: rotateZ(360deg);
            }
        }

        @-webkit-keyframes rotateImg {
            0% {
                -webkit-transform: rotateZ(0deg);
            }
            50% {
                -webkit-transform: rotateZ(180deg);
            }
            100% {
                -webkit-transform: rotateZ(360deg);
            }
        }

        @media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {
            .pin-spinner-2 {
                margin-top: -.82rem;
            }
        }
        .swiper-container-horizontal>.swiper-pagination-bullets, .swiper-pagination-custom, .swiper-pagination-fraction{
            padding-left:3rem;
            line-height: .13rem;
            color: #fff;
            font-size: .13rem;
            z-index: 999;
            opacity: .75;
            text-shadow: 0 0 0.06rem #9c9c9c;
        }
        [v-cloak]{
            display: none;
        }
    </style>
</head>

<body id="goods" style="left: calc(50vw - 1.875rem);">
<div id="app" v-cloak>
    <div id="main" class="container no-footer">
        <div id="banner" class="goods-banner" style="height: 3.75rem;">
            <!-- Swiper -->
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide" v-for="(item,index) in detailInfo.gpicHead" @click="bannerFullPage(index)">
                        <img style="height: 3.75rem;" :src="item">
                    </div>
                </div>
                <div class="swiper-pagination" style=""></div>
            </div>
        </div>
        <div class="goods-header-top-container">
            <section id="g-base" class="false">
                <div class="g-price-group"><span class="g-group-price" v-html="'<i>ï¿¥</i>'+detailInfo.goodRes.groupprice"></span><span class="g-sales regular-text" v-text="'å·²å”®'+detailInfo.goodRes.sellnum+'ä»¶'"></span>
                </div>
                <div class="g-name-new"><span class="goods-name-content"><span><span class="g-n-goods-title"><span class="enable-select" v-text="detailInfo.goodRes.gname"></span></span><span></span></span>
                    </span>
                </div>
            </section>
            <div class="goods-header no-hs-bp-at false">
                <div>
                    <div class="g-h-div"></div>
                    <div data-active="before-white" class="g-h-services" @click="showService">
                        <div class="g-h-service">
                            <div class="g-h-service-txt first-service">æé€Ÿé€€æ¬¾</div>
                        </div>
                        <div class="g-h-service">
                            <div class="g-h-service-dot"></div>
                            <div class="g-h-service-txt">å…¨åœºåŒ…é‚®</div>
                        </div>
                        <div class="g-h-service">
                            <div class="g-h-service-dot"></div>
                            <div class="g-h-service-txt">7å¤©é€€æ¢</div>
                        </div>
                        <div class="g-h-service">
                            <div class="g-h-service-dot"></div>
                            <div class="g-h-service-txt">48å°æ—¶å‘è´§</div>
                        </div>
                        <div class="g-h-enter"><span class="g-h-enter-icon"></span>

                        </div>
                    </div>
                    <section class="service-detail-bg" v-show="serviceShow">
                        <div class="gh-service-detail-main gh-main-show">
                            <div class="gh-service-title"><span>æœåŠ¡è¯´æ˜</span>
                                <div class="gh-service-close-btn " @click="hideService"></div>
                            </div>
                            <div id="gh-service-modal-list-service" class="gh-service-modal-content">
                                <div class="gh-service-content">
                                    <div class="gh-service-item" data-url="">
                                        <div class="gh-service-left">
                                            <div class="gh-service-item-top"><span class="gh-ms-item-icon"></span><span class="gh-service-item-name">é€€è´§åŒ…è¿è´¹</span>
                                            </div><span class="service-item-desc">ç¡®è®¤æ”¶è´§å‰ç”³è¯·é€€è´§é€€æ¬¾ï¼Œæ¶ˆè´¹è€…å°†ä¼šæ”¶åˆ°é€€è´§è¿è´¹è¡¥è´´</span>
                                        </div>
                                    </div>
                                    <div class="gh-service-item" data-url="">
                                        <div class="gh-service-left">
                                            <div class="gh-service-item-top"><span class="gh-ms-item-icon"></span><span class="gh-service-item-name">æé€Ÿé€€æ¬¾</span>
                                            </div><span class="service-item-desc">æ‹¼å•æˆåŠŸ6å°æ—¶å†…ï¼Œå¾…å‘è´§çŠ¶æ€ä¸‹ï¼Œæäº¤é€€æ¬¾ç”³è¯·å°†ç«‹å³é€€æ¬¾</span>
                                        </div>
                                    </div>
                                    <div class="gh-service-item" data-url="">
                                        <div class="gh-service-left">
                                            <div class="gh-service-item-top"><span class="gh-ms-item-icon"></span><span class="gh-service-item-name">å…¨åœºåŒ…é‚®</span>
                                            </div><span class="service-item-desc">æ‰€æœ‰å•†å“å‡æ— æ¡ä»¶åŒ…é‚®</span>
                                        </div>
                                    </div>
                                    <div class="gh-service-item" data-url="">
                                        <div class="gh-service-left">
                                            <div class="gh-service-item-top"><span class="gh-ms-item-icon"></span><span class="gh-service-item-name">7å¤©é€€æ¢</span>
                                            </div><span class="service-item-desc">æ»¡è¶³ç›¸åº”æ¡ä»¶æ—¶ï¼Œæ¶ˆè´¹è€…å¯ç”³è¯·7å¤©æ— ç†ç”±é€€æ¢è´§</span>
                                        </div>
                                    </div>
                                    <div class="gh-service-item" data-url="">
                                        <div class="gh-service-left">
                                            <div class="gh-service-item-top"><span class="gh-ms-item-icon"></span><span class="gh-service-item-name">48å°æ—¶å‘è´§</span>
                                            </div><span class="service-item-desc">è‹¥è¶…æ—¶æœªå‘è´§ï¼Œæ¶ˆè´¹è€…å°†ä¼šæ”¶åˆ°è‡³å°‘3å…ƒæ— é—¨æ§›ä»£é‡‘åˆ¸</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
        <div id="g-local-groups">
            <div class="local-groups-title regular-cell" v-text="vuData.length+'äººåœ¨æ‹¼å•ï¼Œå¯ç›´æ¥å‚ä¸'"></div>
            <div class="local-group-container">
                <div>
                    <div>
                        <div class="local-group-item" v-for="(item,index) in vuData" >
                            <img class="local-group-img" :src="item.avatar">
                            <div class="new-local-group-detail ">
                                <div class="local-group-name" v-text="item.uname"></div>
                                <div class="local-group-info">
                                    <div class="local-group-person" >è¿˜å·®<span class="local-group-num">1äºº</span>æ‹¼æˆ</div>
                                    <span class="local-group-timer" v-text="formatTime(item.leftTime)"></span>
                                </div>
                            </div>
                            <div class="local-group-btn-border special-btn" @click="showSku(2)">å»æ‹¼å•</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="goods-reviews-module " class="goods-reviews-container" @click="goComments">
            <div class="goods-reviews-header " data-active="before-white ">
                <div class="goods-reviews-title ">
                    <div class="goods-reviews-num " v-text="'å•†å“è¯„ä»·'"></div> <span class="goods-reviews-more ">æŸ¥çœ‹å…¨éƒ¨</span>
                </div>
            </div>
            <div class="goods-reviews-list">
                <div :class="index>0?'reviews-item-bt':'reviews-item'" v-for="(item,index) in judge">
                    <div class="reviews-item-title ">
                        <img :src="item.avatar"><span class="reviews-item-name" v-text="item.uname"></span>
                    </div>
                    <div class="reviews-item-content" v-text="item.info"></div>
                </div>
            </div>
        </div>
        <div>
            <div class="goods-mall-in-grey showDsrStatus ">
                <div class="goods-mall-main-in-grey ">
                    <div class="mall-logo ">
                        <img :src="shopInfo.shop_logo">
                    </div>
                    <div class="goods-mall-info ">
                        <div class="goods-mall-first-line ">
                            <div class="goods-mall-name" v-text="shopInfo.shop_name"></div>
                        </div>
                        <div><span v-text="'å•†å“æ•°é‡: '+shopInfo.goodsNum">å•†å“æ•°é‡ï¼š0</span><span v-text="'æ”¶è—æ•°é‡: '+shopInfo.mark_num">æ”¶è—æ•°é‡ï¼š0</span>

                        </div>
                    </div>
                    <div class="goods-mall-btn" @click="goShop"><span>è¿›åº—é€›é€›</span>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <div class="goods-details ">
                <p>å•†å“è¯¦æƒ…</p>
                <div class="gd-item " v-for="(item,index) in detailInfo.gpicInfo">
                    <img class="gd-img" style="width: 100%;" :src="item">
                </div>
            </div>
        </div>
        <!-- åº•éƒ¨èœå• -->
        <div>
            <div class="goods-bottom-bar ">
                <div class="goods-home-button-new " @click="showMore"><span class="goods-home-icon-new">æ›´å¤š</span>

                </div>
                <div :class="isCollect?'goods-like-button-new':'goods-unlike-button-new'" @click="collectGoods"><span>æ”¶è—</span>

                </div>
                <div class="goods-chat-button-new " data-active="before-white "><span>å®¢æœ</span>

                </div>
                <div class="goods-direct-btn-new " data-active="before-red" @click="showSku(1)"><span class="goods-buy-price " style="font-size:0.17rem "><i
                        style="font-size:calc(0.17rem - 0.01rem) ">ï¿¥</i>{{detailInfo.goodRes.price}}</span><span>å•ç‹¬è´­ä¹°</span>

                </div>
                <div class="goods-group-btn-new " data-active="before-red" @click="showSku(2)"><span class="goods-buy-price " style="font-size:0.17rem "><i
                        style="font-size:calc(0.17rem - 0.01rem) ">ï¿¥</i>{{detailInfo.goodRes.groupprice}}</span><span>å‘èµ·æ‹¼å•</span>

                </div>
            </div>
            <!-- å•†å“sku -->
            <section class="sku-selector-bg " v-show="skuShow">
                <div class="sku-selector-main sku-selector-main-show">
                    <div class="sku-selector-container ">
                        <div class="sku-selector-head ">
                            <img :src="skuSelDetailInfo.pic">
                            <div class="sku-selector-head-content ">
                                <div class="sku-selector-price">
                                    ï¿¥{{skuSelDetailInfo.groupprice}}
                                    <span class="sku-quantity-tip">ä»…å‰©ï¼š{{skuSelDetailInfo.stock}}</span>
                                </div>
                                <div class="sku-selector-desc" v-text="skuText"></div>
                            </div>
                            <div class="sku-selector-close-btn " @click="hideSku"></div>
                        </div>
                        <div id="sku-selector-body">
                            <div class="sku-specs" v-for="(item,index) in detailInfo.goodsFormat">
                                <span class="sku-specs-key " v-text="item.gfname"></span>
                                <div class="sku-spec-value-list">
                                    <div class="sku-spec-value" :class="item1.selected&&'sku-spec-value-selected'" @click="selectSku(item.gfname,item1.gftid,item1.gftname,index,index1)" v-for="(item1,index1) in item.child" data-active="before-white" v-text="item1.gftname"></div>
                                </div>
                            </div>
                            <div class="sku-selector-number "><span>æ•°é‡</span>

                                <div class="sku-selector-reduce" :class="buyCount==1&&'sku-selector-reduce-disable'" @click="buyCountControl(0)"></div>
                                <input type="number " class="sku-selector-input " maxlength="5 " v-model="buyCount">
                                <div class="sku-selector-increase" :class="buyCount==skuSelDetailInfo.stock&&'sku-selector-increase-disable'" @click="buyCountControl(1)"></div>
                            </div>
                            <div class="safe-distance "></div>
                        </div>
                        <div class="sku-selector-bottom" v-show="skuOk" @click="quickBuy">ç¡®å®š</div>
                        <div class="sku-selector-bottom" v-show="!skuOk" style="background: #bbb;">ç¡®å®š</div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    <!--æ‹¼å•-->
    <div v-if="showPin">
        <div class="g-group-pop-up">
            <div class="bg-fill"></div>
            <div class="g-group-pop-up-wrapper">
                <div class="g-group-header">
                    <div class="g-group-title">å‚åŠ <span class="g-group-user-name">ğŸ’Læš–æš–CğŸ’</span>çš„æ‹¼å•</div>
                    <div class="g-group-info">ä»…å‰©<span>1</span>ä¸ªåé¢ï¼Œ<i>23:51:31.5</i>åç»“æŸ</div>
                    <div class="g-group-close"></div>
                </div>
                <div class="g-group-content">
                    <ul class="g-group-users">
                        <li class="g-group-detail-user g-group-detail-owner" style="background: url("//t20img.yangkeduo.com/a/091fb02abda0e73f1e12c192e73b0020247eac3c-1550148462?imageMogr2/thumbnail/100x") 0% 0% / 100% 100%;"></li>
                        <li class="g-group-wait-user"></li>
                    </ul>
                </div>
                <div class="g-group-footer">
                    <button data-active="before-red">å‚ä¸æ‹¼å•</button>
                </div>
            </div>
        </div>
    </div>
     <!--æ›´å¤šèœå•-->
    <div>
        <div class="goods-home-button-new-fill" @click="showMore" v-show="isShowMore">
            <div class="goods-bottom-tab">
                <div class="goods-bottom-content">
                    <div class="g-b-c-item g-b-t-history"><span>å†å²æµè§ˆ</span>
                    </div>
                    <div class="g-b-c-item g-b-t-home" onclick="window.location.href='index.html'"><span>å›åˆ°é¦–é¡µ</span>
                    </div>
                </div><span class="goods-bottom-tab-tri-1"></span>
            </div>
        </div>
    </div>
</div>
<div id="global-disable-click">
    <div class="scroll-container-hidden"></div>
</div>
<script src="./script/jquery-3.2.1.min.js"></script>
<script src="./script/common.js"></script>
<script src="./script/aui-toast.js"></script>
<script src="./script/config.js"></script>
<script src="./script/yltcrypt.js"></script>
<script src="./script/vue.js"></script>
<script src="./script/swiper.min.js"></script>
<script src="./script/previewImage.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
<script type="text/javascript">
    var pageParam=pageParam();
    var userInfo = JSON.parse(getStorage("userInfo"));
    var vm=new Vue({
        el:"#app",
        data:{
            detailInfo:{goodRes:{
                gid: "",
                shopid: "",
                gname: "",
                price: "",
                groupprice: "",
                groupnum: "",
                grouphours: "",
                stock: "",
                sellnum: "0",
                score: "",
                judge: ""
            }},
            serviceShow:false,
            skuShow:false,
            skuSelected:{},
            skuText:"",
            skuSelDetailInfo:{},
            selected_ids:null,
            buyCount:1,
            skuOk:false,
            vuData:[],
            showPin:false,
            pinIndex:0,
            judge:[],
            shopInfo:{},
            isCollect:false,
            isShowMore:false,
            buyType:0
        },
        methods:{
            loadDetailInfo:function(){
                // åŠ è½½å•†å“è¯¦æƒ…
                var self=this;
                $.ajax({
                    url:PHP_SERVE_URL+"/shop/goodsInfo",
                    type:"post",
                    data:{goodsId:pageParam.goodsId},
                    success:function (res) {
                        if(res.code==0){
                           for(var a in res.data.goodsFormat){
                                for(var x in res.data.goodsFormat[a].child){
                                    res.data.goodsFormat[a].child[x].selected=false;
                                }
                           }
                           self.detailInfo=res.data;
                           // åŠ è½½å•†é“ºä¿¡æ¯
                           self.loadShopInfo();
                           self.vuData=res.data.vuData;
                           if(self.vuData.length>0){
                                // æ‹¼å•å€’è®¡æ—¶
                               setInterval(function(){
                                    self.vuDataCutDown();
                               },1000);
                           }
                           if(self.vuData.length>2){
                                // æ‹¼å•æ»šåŠ¨
                               setInterval(function(){
                                    var el=$(".local-group-item")[0];
                                    var height=$(el).innerHeight();
                                    $(el).animate({"margin-top":-height+"px"},function(){
                                        $(el).css({"margin-top":"0px"});
                                        $(".local-group-container>div>div").append(el);
                                    });
                               },5000);
                           }
                            self.skuText="è¯·é€‰æ‹©";
                            for(var i in res.data.goodsFormat){
                                self.skuSelected[res.data.goodsFormat[i].gfname]={};
                                self.skuText+=" "+res.data.goodsFormat[i].gfname;
                            }
                            setTimeout(function () {
                                var swiper = new Swiper('.swiper-container', {
                                    pagination: {
                                        el: '.swiper-pagination',
                                        type: 'fraction',
                                    },
                                });
                            });
                            if(res.data.gprice[0]){
                                self.skuSelDetailInfo=res.data.gprice[0];
                            }else{
                                self.skuSelDetailInfo=res.data.goodRes;
                                self.skuSelDetailInfo.pic = res.data.gpicHead[0];
                                self.skuOk=true;
                            }
                        }
                    }
                });
            },
            showService:function () {
                // æ˜¾ç¤ºæœåŠ¡
                var self=this;
                self.serviceShow=true;
            },
            hideService:function () {
                var self=this;
                self.serviceShow=false;
            },
            showSku:function (type) {
                var self=this;
                self.skuShow=true;
                self.buyType=type;
            },
            hideSku:function () {
                var self=this;
                self.skuShow=false;
            },
            selectSku:function (type,id,name,typeIndex,itemIndex) {
                var self=this;
                // è®°å½•skué€‰çš„å€¼
                self.$set(self.skuSelected[type],"id",id);
                self.$set(self.skuSelected[type],"name",name);
                self.skuText="";
                // å–æ¶ˆæ‰€æœ‰é€‰ä¸­çš„çŠ¶æ€
                for(var x in self.detailInfo.goodsFormat[typeIndex].child){
                    self.$set(self.detailInfo.goodsFormat[typeIndex].child[x],"selected",false);
                }
                // æ·»åŠ é€‰æ‹©çŠ¶æ€
                self.$set(self.detailInfo.goodsFormat[typeIndex].child[itemIndex],"selected",true);
                // ç”Ÿæˆskué€‰é¡¹å±•ç¤ºçš„æ–‡æœ¬
                for(var i in self.skuSelected){
                    if(self.skuSelected[i].id){
                        self.skuText+=" "+self.skuSelected[i].name;
                        self.skuOk=true;
                    }else if(!self.skuSelected[i].id){
                        self.skuText="è¯·é€‰æ‹©";
                        for(var b in self.skuSelected){
                            if(!self.skuSelected[b].id){
                                self.skuText+=" "+b;
                            }
                        }
                        self.skuOk=false;
                        break;
                    }
                }
                // è·å–é€‰å®šçš„å‚æ•°idï¼Œç”ŸæˆåŒ¹é…skuå•ä¸ªé¡¹å•†å“æ‰€éœ€è¦çš„id
                var idsArr=[];
                for(var a in self.skuSelected){
                    if(self.skuSelected[a].id){
                        idsArr.unshift(self.skuSelected[a].id);
                    }
                }
                // æ ¹æ®é€‰å®šçš„å‚æ•°idï¼ŒåŒ¹é…skuå•ä¸ªé¡¹å•†å“çš„ä¿¡æ¯
                idsArr.sort(function(a,b){
                    if(a<b){
                        return -1;
                    }
                    if(a>b){
                        return 1;
                    }
                    return 0;
                });
                self.selected_ids=idsArr.join(",");
                for(var skuIndex in self.detailInfo.gprice){
                    if(self.detailInfo.gprice[skuIndex].format_ids==self.selected_ids){
                        self.skuSelDetailInfo=self.detailInfo.gprice[skuIndex];
                    }
                }
            },
            buyCountControl:function (type) {
                // è´­ä¹°æ•°é‡æ§åˆ¶
                var self=this;
                if(type==0){
                    if(self.buyCount>1){
                        self.buyCount--;
                    }
                }else if(type==1){
                    if(self.buyCount<self.skuSelDetailInfo.stock){
                        self.buyCount++;
                    }
                }
            },
            quickBuy:function () {
                // ä¸‹å•
                var self=this;
                var orderParam={gid:self.skuSelDetailInfo.gid,
                    num:self.buyCount,
                    shopId:self.detailInfo.goodRes.shopid,
                    formatIds:self.skuSelDetailInfo.format_ids,
                    shopName:self.shopInfo.shop_name,
                    shopLogo:self.shopInfo.shop_logo,
                    gname:self.detailInfo.goodRes.gname,
                    gpic:self.detailInfo.gpicHead[0],
                    skutext:self.skuText,
                    gprice:self.skuSelDetailInfo.groupprice,
                    btype:1
                };
                setStorage('orderParam',orderParam);
                window.location.href="order_pay.html";
            },
            formatTime:function(seconds){
                // æ ¼å¼åŒ–æ‹¼å›¢æ—¶é—´
                var hour=parseInt(seconds/3600)<10?'0'+parseInt(seconds/3600):parseInt(seconds/3600);
                var minute=parseInt(seconds%3600/60)<10?'0'+parseInt(seconds%3600/60):parseInt(seconds%3600/60);
                var second=seconds%3600%60<10?'0'+(seconds%3600%60):seconds%3600%60;
                return "å‰©ä½™"+hour+":"+minute+":"+second;
            },
            vuDataCutDown:function(){
                // æ‹¼å›¢æ—¶é—´å€’æ•°
                var self=this;
                vuData=self.vuData;
                for(var i in vuData){
                    vuData[i].leftTime--;
                }
                self.vuData=vuData;
            },
            loadGoodsJudge:function(){
                // åŠ è½½å•†å“è¯„è®º
                var self=this;
                $.ajax({
                    url:PHP_SERVE_URL+"/shop/goodsJudge",
                    type:"post",
                    data:{goodsId:pageParam.goodsId,pageIndex:1,pageSize:2},
                    success:function (res) {
                        if(res.code==0){
                            self.judge=res.data;
                        }else{
                            alert(res.msg);
                        }
                    }
                });
            },
            loadShopInfo:function(){
                // åŠ è½½å•†é“ºä¿¡æ¯
                var self=this;
                $.ajax({
                    url:PHP_SERVE_URL+"/shop/shopInfo",
                    type:"post",
                    data:{shopId:self.detailInfo.goodRes.shopid},
                    success:function (res) {
                        if(res.code==0){
                            self.shopInfo=res.data;
                        }
                    }
                });
            },
            goShop:function(){
                // å‰å¾€å•†åº—
                var self=this;
                window.location.href="store_detail.html?shopId="+self.detailInfo.goodRes.shopid;
            },
            getCollectBool:function(){
                // è·å–æ”¶è—çŠ¶æ€
                var self=this;
                $.ajax({
                    url:PHP_SERVE_URL+"/shop/getCollectBool",
                    type:"post",
                    data:{type:1,cid:pageParam.goodsId,openId:userInfo.open_id},
                    success:function (res) {
                        if(res.code==0){
                            self.isCollect=Boolean(res.isCollect);
                        }
                    }
                });
            },
            collectGoods:function(){
                var self=this;
                $.ajax({
                    url:PHP_SERVE_URL+"/shop/collectGoods",
                    type:"post",
                    data:{goodsId:pageParam.goodsId,openId:userInfo.open_id},
                    success:function (res) {
                        if(res.code==0){
                            self.isCollect=!self.isCollect;
                        }else{
                            alert(res.msg);
                        }
                    }
                });
            },
            showMore:function(){
                var self=this;
                self.isShowMore=!self.isShowMore;
            },
            bannerFullPage:function(index){
                var self=this;
                var obj = {
                        urls : self.detailInfo.gpicHead,
                        current : self.detailInfo.gpicHead[index]
                    };
                previewImage.start(obj);
            },
            goComments:function(){
                // å‰å¾€è¯„è®º
                window.location.href="goods_comments.html?goodsId="+pageParam.goodsId;
            }
        },
        watch:{
            buyCount:function (newVal,oldVal) {
                var self=this;
                if(parseInt(newVal)<1){
                    self.buyCount=1;
                }else if(parseInt(newVal)>parseInt(self.skuSelDetailInfo.stock)){
                    self.buyCount=self.skuSelDetailInfo.stock;
                }else if(isNaN(parseInt(newVal))){
                    self.buyCount=1;
                }else{
                    self.buyCount=parseInt(newVal);
                }
            },
            skuSelDetailInfo:function (newVal,oldVal) {
                var self=this;
                if(parseInt(newVal.stock)>0){
                    self.buyCount=1;
                }else{
                    self.skuOk=false;
                }
            }
        },
        mounted:function () {
            var self=this;
            this.loadDetailInfo();
            self.loadGoodsJudge();
            self.getCollectBool();
        }
  });
    getWxSign();
    function getWxSign() {
        var userInfoShare = JSON.parse(getStorage('userInfo'));
        if(!userInfoShare){
            userInfoShare.open_id = 0;
        }
        $.ajax({
            type: 'POST',
            url: PHP_SERVE_URL + '/weixin/jssdkConfig',
            data: {
                url: location.href.split('#')[0],
            },
            dataType: "json",
            success: function (ret, res) {
                if (ret.code == 0) {
                    wx.config({
                        debug: false, // å¼€å¯è°ƒè¯•æ¨¡å¼,è°ƒç”¨çš„æ‰€æœ‰apiçš„è¿”å›å€¼ä¼šåœ¨å®¢æˆ·ç«¯alertå‡ºæ¥ï¼Œè‹¥è¦æŸ¥çœ‹ä¼ å…¥çš„å‚æ•°ï¼Œå¯ä»¥åœ¨pcç«¯æ‰“å¼€ï¼Œå‚æ•°ä¿¡æ¯ä¼šé€šè¿‡logæ‰“å‡ºï¼Œä»…åœ¨pcç«¯æ—¶æ‰ä¼šæ‰“å°ã€‚
                        appId: ret.data.appId, // å¿…å¡«ï¼Œå…¬ä¼—å·çš„å”¯ä¸€æ ‡è¯†
                        timestamp: ret.data.timestamp, // å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„æ—¶é—´æˆ³
                        nonceStr: ret.data.nonceStr, // å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„éšæœºä¸²
                        signature: ret.data.signature,// å¿…å¡«ï¼Œç­¾å
                        jsApiList: ['updateAppMessageShareData','updateTimelineShareData','onMenuShareTimeline','onMenuShareAppMessage'] // å¿…å¡«ï¼Œéœ€è¦ä½¿ç”¨çš„JSæ¥å£åˆ—è¡¨
                    });
                    wx.ready(function() {
                        wx.updateAppMessageShareData({
                            title: 'Fè´­å•†åŸ', // åˆ†äº«æ ‡é¢˜
                            desc: 'Fè´­å•†åŸå®ç°å•†å®¶ä¸æ¶ˆè´¹è€…å…±èµ¢çš„ï¼Œä¹°çš„è¶Šå¤šèµšå¾—è¶Šå¤šï¼', // åˆ†äº«æè¿°
                            link: PHP_SERVE_URL+'/sharelogin.html?lopenId='+userInfoShare.open_id, // åˆ†äº«é“¾æ¥ï¼Œè¯¥é“¾æ¥åŸŸåæˆ–è·¯å¾„å¿…é¡»ä¸å½“å‰é¡µé¢å¯¹åº”çš„å…¬ä¼—å·JSå®‰å…¨åŸŸåä¸€è‡´
                            imgUrl: 'http://media1.0571sd.com/tmp/fgouhead.jpg', // åˆ†äº«å›¾æ ‡
                            success: function (res) {
                            }
                        });
                        wx.updateTimelineShareData({
                            title: 'Fè´­å•†åŸ', // åˆ†äº«æ ‡é¢˜
                            link: PHP_SERVE_URL+'/sharelogin.html?lopenId='+userInfoShare.open_id, // åˆ†äº«é“¾æ¥ï¼Œè¯¥é“¾æ¥åŸŸåæˆ–è·¯å¾„å¿…é¡»ä¸å½“å‰é¡µé¢å¯¹åº”çš„å…¬ä¼—å·JSå®‰å…¨åŸŸåä¸€è‡´
                            imgUrl: 'http://media1.0571sd.com/tmp/fgouhead.jpg', // åˆ†äº«å›¾æ ‡
                            success: function () {
                            }
                        });
                    });
                }
            }
        })
    }
</script>
</body>
</html>